{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>{{ school_name|default:"Kizita School Demo" }}</title>

  <!-- Bootstrap CSS from CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Toastr CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">

  <!-- OverlayScrollbars -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.13.1/css/OverlayScrollbars.min.css" rel="stylesheet">

  <!-- DataTables -->
  <link href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css" rel="stylesheet">

  <!-- AdminLTE Theme -->
  <link href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css" rel="stylesheet">

  <!-- Google Fonts (Optional) -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
  
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.dark-mode {
      background-color: #222 !important;
      color: #ccc !important;
    }

    .main-sidebar {
      transition: all 0.3s ease;
    }

    .sidebar {
      background-color: #212529 !important;
    }
    .dark-mode .sidebar {
      background-color: #1c1c1c !important;
    }

    .sidebar .brand-link {
      background-color: #00bfff !important;
      color: #ffffff !important;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    .dark-mode .brand-link {
      background-color: #0177a8 !important;
    }

    .sidebar .nav-link {
      color: #ffffff !important;
      font-size: 14px !important;
      font-family: 'Roboto', sans-serif;
      font-weight: normal;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .sidebar .nav-link:hover {
      background-color: #343a40 !important;
    }

    .sidebar .nav-header {
      color: #00bfff !important;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 12px;
      margin-top: 15px;
      margin-bottom: 5px;
      letter-spacing: 1px;
      font-family: 'Verdana', sans-serif;
    }
    .dark-mode .sidebar .nav-header {
      color: #66c2ff !important;
    }

    .sidebar .nav-icon {
      font-size: 16px;
      margin-right: 10px;
    }
    .sidebar .nav-link.active {
      background-color: #00bfff !important;
      color: #ffffff !important;
      font-weight: bold;
    }
    .dark-mode .sidebar .nav-link.active {
      background-color: #0177a8 !important;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #00bfff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 10px;
      visibility: hidden;
    }
    .link-loading .loading-spinner {
      visibility: visible;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .main-header.navbar {
      background-color: #343a40 !important;
      border-bottom: 1px solid #474f57;
    }
    .main-header.navbar .navbar-nav .nav-link {
      color: #ffffff;
      transition: color 0.3s ease;
    }
    .main-header.navbar .nav-link:hover {
      color: #00bfff;
    }
    .dark-mode .main-header.navbar {
      background-color: #2b2b2b !important;
      border-bottom: 1px solid #3a3a3a;
    }
    .dark-mode .main-header.navbar .nav-link {
      color: #ccc;
    }
    .dark-mode .main-header.navbar .nav-link:hover {
      color: #66c2ff;
    }

    .breadcrumb-item {
      font-size: 0.9rem;
      color: #666;
      transition: color 0.3s ease;
    }
    .breadcrumb-item a {
      color: #666;
    }
    .breadcrumb-item a:hover {
      color: #00bfff;
    }
    .dark-mode .breadcrumb-item,
    .dark-mode .breadcrumb-item a {
      color: #aaa;
    }
    .dark-mode .breadcrumb-item a:hover {
      color: #66c2ff;
    }

    .content-wrapper {
      transition: background-color 0.3s ease, color 0.3s ease;
      background-color: #f4f6f9;
    }
    .dark-mode .content-wrapper {
      background-color: #1e1e1e;
    }

    .card {
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .dark-mode .card {
      background-color: #2b2b2b;
      color: #ccc;
    }

    #contactSlideUp {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #00bfff;
      color: #fff;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      z-index: 9999;
    }
    #contactSlideUp:hover {
      background-color: #0099cc;
    }
    .dark-mode #contactSlideUp {
      background-color: #0177a8;
    }

    .navbar-nav .nav-item .mode-toggle {
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #ffffff;
      margin-right: 1rem;
    }
    .mode-toggle i {
      margin-right: 5px;
    }
    .mode-toggle:hover {
      color: #00bfff;
    }

    #loadingMessage, #noUrlMessage {
      display: none; 
      position: fixed; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      padding: 20px;
      border: 1px solid #ccc;
      z-index: 9999;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .dark-mode #loadingMessage, .dark-mode #noUrlMessage {
      background: #333;
      border-color: #444;
      color: #eee;
    }

    .blue-ticks {
      background-color: #e0f7fa;
    }
    .red-ticks {
      background-color: #ffebee;
    }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
  <!-- Loading spinner -->
  <div id="loadingMessage">
    <div class="loading-spinner"></div>
    <p style="color: blue;">Loading.....</p>
  </div>

  <div id="noUrlMessage">No URL found</div>

  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-dark bg-dark">
      <!-- Left navbar links -->
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="{% url 'dashboard' %}" class="nav-link"><i class="fas fa-home"></i> Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <span class="nav-link"><i class="fas fa-calendar-alt"></i> Year: {{ current_session }}</span>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <span class="nav-link"><i class="fas fa-clock"></i> Term: {{ current_term }}</span>
        </li>
      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ms-auto">
        <!-- Dark Mode Toggle -->
        <li class="nav-item">
          <div class="nav-link mode-toggle" id="modeToggle">
            <i class="fas fa-adjust"></i><span>Dark Mode</span>
          </div>
        </li>
        
        <!-- Client-side Search Input (No server function) -->
        <li class="nav-item">
          <input type="text" id="searchInput" class="form-control" placeholder="Search dashboard..." style="width: 200px; margin-top:6px; margin-right:10px;">
        </li>

        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link" data-bs-toggle="dropdown" href="#">
              {% if user.profile_picture %}
                <img src="{{ user.profile_picture.url }}" class="rounded-circle" width="30" height="30">
              {% else %}
                <i class="far fa-user-circle fa-lg"></i>
              {% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a href="{% url 'admin_profile' %}" class="dropdown-item"><i class="fas fa-user"></i> Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a href="{% url 'logout' %}" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
          </li>
        {% else %}
          <li class="nav-item">
            <a href="{% url 'login' %}" class="nav-link"><i class="fas fa-sign-in-alt"></i> Login</a>
          </li>
        {% endif %}
        
        <li class="nav-item">
          <a href="{% url 'goto-admin' %}" class="nav-link"><i class="fas fa-cogs"></i> Admin</a>
        </li>
        
        <!-- Notifications Dropdown Menu -->
        <li class="nav-item dropdown">
          <a class="nav-link" data-bs-toggle="dropdown" href="#">
            <i class="far fa-bell"></i>
            <span class="badge badge-warning navbar-badge">3</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><span class="dropdown-header">3 Notifications</span></li>
            <li><hr class="dropdown-divider"></li>
            <li><a href="#" class="dropdown-item"><i class="fas fa-envelope mr-2"></i> 1 new message <span class="float-end text-muted text-sm">3 mins ago</span></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a href="#" class="dropdown-item"><i class="fas fa-users mr-2"></i> 2 friend requests <span class="float-end text-muted text-sm">12 hours ago</span></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a href="#" class="dropdown-item"><i class="fas fa-file-alt mr-2"></i> 3 new reports <span class="float-end text-muted text-sm">2 days ago</span></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a href="#" class="dropdown-item dropdown-footer">See All Notifications</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    <!-- /.navbar -->

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="{% url 'dashboard' %}" class="brand-link text-center py-3">
        <i class="fas fa-school fa-lg me-2"></i>
        <span>School Demo</span>
        <span class="loading-spinner"></span>
      </a>
    
      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar Menu -->
        <nav class="mt-3">
          <ul class="nav nav-pills nav-sidebar flex-column" id="dashboardItems" data-widget="treeview" role="menu" data-accordion="false">

            <!-- Results Section Updated with Provided URLs -->
            <li class="nav-header">Results</li>
            <li class="nav-item">
              <a href="{% url 'create-result' %}" class="nav-link">
                <i class="nav-icon fas fa-plus text-info"></i>
                <p>Create Result</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'edit-results' %}" class="nav-link">
                <i class="nav-icon fas fa-edit text-primary"></i>
                <p>Edit Results</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'edit-now-results' %}" class="nav-link">
                <i class="nav-icon fas fa-edit text-warning"></i>
                <p>Edit Now Results</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'delete-page-results' %}" class="nav-link">
                <i class="nav-icon fas fa-trash-alt text-danger"></i>
                <p>Delete Results</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'single-class' %}" class="nav-link">
                <i class="nav-icon fas fa-chalkboard-teacher text-danger"></i>
                <p>View Mid-Term Results</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'class-list' %}" class="nav-link">
                <i class="nav-icon fas fa-chalkboard-teacher text-success"></i>
                <p>View Terminal & Annual Results</p>
                <span class="loading-spinner"></span>
              </a>
            </li>

            <!-- Students Management -->
            <li class="nav-header">Students Management</li>
            <li class="nav-item">
              <a href="{% url 'student-list' %}" class="nav-link">
                <i class="nav-icon fas fa-user-graduate text-warning"></i>
                <p>Students</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Staff Management -->
            <li class="nav-header">Staff Management</li>
            <li class="nav-item">
              <a href="{% url 'staff-list' %}" class="nav-link">
                <i class="nav-icon fas fa-users text-success"></i>
                <p>Staffs</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- SMS Section -->
            <li class="nav-header">SMS</li>
            <li class="nav-item">
              <a href="{% url 'send_sms_form' %}" class="nav-link">
                <i class="nav-icon fas fa-envelope text-primary"></i>
                <p>Send SMS</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'sms_history' %}" class="nav-link">
                <i class="nav-icon fas fa-history text-danger"></i>
                <p>SMS History</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Events Section -->
            <li class="nav-header">Events</li>
            <li class="nav-item">
              <a href="{% url 'event_create' %}" class="nav-link">
                <i class="nav-icon fas fa-calendar-plus text-success"></i>
                <p>Add Event</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'event_list' %}" class="nav-link">
                <i class="nav-icon fas fa-calendar-alt text-info"></i>
                <p>View Events</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Finance Management -->
            <li class="nav-header">Finance Management</li>
            <li class="nav-item">
              <a href="{% url 'select_link' %}" class="nav-link">
                <i class="nav-icon fas fa-money-bill-alt text-warning"></i>
                <p>Finances</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Discipline Management -->
            <li class="nav-header">Discipline Management</li>
            <li class="nav-item">
              <a href="{% url 'discipline_issue_list' %}" class="nav-link">
                <i class="nav-icon fas fa-edit text-warning"></i>
                <p>Discipline</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Library Management -->
            <li class="nav-header">Library Management</li>
            <li class="nav-item">
              <a href="{% url 'view_available_books' %}" class="nav-link">
                <i class="nav-icon fas fa-book-open text-info"></i>
                <p>Manage Books</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
            <li class="nav-item">
              <a href="{% url 'stationery_list' %}" class="nav-link">
                <i class="nav-icon fas fa-pen-alt text-primary"></i>
                <p>Stationeries</p>
                <span class="loading-spinner"></span>
              </a>
            </li>
    
            <!-- Comments -->
            <li class="nav-header">Comments</li>
            <li class="nav-item">
              <a href="{% url 'all_parents_comments' %}" class="nav-link">
                <i class="nav-icon fas fa-comments text-success"></i>
                <p>Parent Comments</p>
                <span class="loading-spinner"></span>
              </a>
            </li>

            <!-- Management -->
            <li class="nav-header">Management</li>
            <li class="nav-item has-treeview">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-tools text-primary"></i>
                <p>Management <i class="fas fa-angle-left right"></i></p>
              </a>
              <ul class="nav nav-treeview ms-3">
                <li class="nav-item">
                  <a href="{% url 'sessions' %}" class="nav-link">
                    <i class="nav-icon fas fa-calendar text-warning"></i>
                    <p>Years</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'terms' %}" class="nav-link">
                    <i class="nav-icon fas fa-calendar-alt text-info"></i>
                    <p>Terms</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'installs' %}" class="nav-link">
                    <i class="nav-icon fas fa-calendar-check text-success"></i>
                    <p>Installments</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'exams' %}" class="nav-link">
                    <i class="nav-icon fas fa-clipboard-list text-primary"></i>
                    <p>Exam Type</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'subjects' %}" class="nav-link">
                    <i class="nav-icon fas fa-book-reader text-danger"></i>
                    <p>Subjects</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'classes' %}" class="nav-link">
                    <i class="nav-icon fas fa-chalkboard-teacher text-info"></i>
                    <p>Classes</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'signature_list' %}" class="nav-link">
                    <i class="nav-icon fas fa-signature text-primary"></i>
                    <p>Signature</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'move_students' %}" class="nav-link">
                    <i class="nav-icon fas fa-exchange-alt text-warning"></i>
                    <p>Move Students</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'delete_students' %}" class="nav-link">
                    <i class="nav-icon fas fa-trash-alt text-danger"></i>
                    <p>Delete Students</p>
                  </a>
                </li>
              </ul>
            </li>

            <!-- Analytics -->
            <li class="nav-header">Analytics</li>
            <li class="nav-item">
              <a href="{% url 'analytics-home' %}" class="nav-link">
                <i class="nav-icon fas fa-chart-line text-success"></i>
                <p>Analytics</p>
                <span class="loading-spinner"></span>
              </a>
            </li>

          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>
    
    <!-- Content Wrapper -->
    <div class="content-wrapper py-2">
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-1">
            <div class="col-sm-8">
              <h1 class="fw-bold">{% block title %}{% endblock title %}</h1>
            </div>
            <div class="col-sm-4">
              <ol class="breadcrumb float-sm-end">
                <li class="breadcrumb-item">{% block breadcrumb %}{% endblock breadcrumb %}</li>
              </ol>
            </div>
          </div>
        </div>
      </section>
      <section class="content">
        <div class="container-fluid">
          {% block fullcard %}
          <div class="card">
            {% block content-header %}{% endblock content-header %}
            <div class="card-body">
              <div class="row">
                <div class="col">
                  {% block content %}
                  {% endblock content %}
                </div>
              </div>
            </div>
          </div>
          {% endblock fullcard %}
        </div>
      </section>
    </div>
    <!-- /.content-wrapper -->

    <div id="contactSlideUp">
      <p>Contact us: <a class="contact-link text-white" href="tel:0750530319">0750530319</a>, <a class="contact-link text-white" href="tel:0762023662">0762023662</a></p>
    </div>

    <aside class="control-sidebar control-sidebar-dark">
    </aside>
  </div>

  <!-- REQUIRED SCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.13.1/js/jquery.overlayScrollbars.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/demo.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  {% if messages %}
  {% for message in messages %}
  <script type="text/javascript">
    toastr.options.progressBar = true;
    toastr.{{ message.tags }}('{{ message }}');
  </script>
  {% endfor %}
  {% endif %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modeToggle = document.getElementById('modeToggle');
      const body = document.body;
      if (localStorage.getItem('mode') === 'dark') {
        body.classList.add('dark-mode');
      }
      modeToggle.addEventListener('click', function() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
          localStorage.setItem('mode', 'dark');
        } else {
          localStorage.setItem('mode', 'light');
        }
      });

      const links = document.querySelectorAll(".nav-link");
      links.forEach((link) => {
        link.addEventListener("click", function (e) {
          if (link.getAttribute('href') !== '#') {
            const spinner = link.querySelector(".loading-spinner");
            if (spinner) spinner.style.visibility = "visible";
          } else {
            e.preventDefault();
          }
        });
      });
  
      (function ($) {
        $('.clickable-row').css('cursor', 'pointer');
        $(".clickable-row").click(function () {
          window.location = $(this).data("href");
        });
      })(jQuery);
  
      function toggleBottomBar() {
        $('#contactSlideUp').slideDown(1000).delay(5000).slideUp(1000);
      }
      setInterval(toggleBottomBar, 15000);
      toggleBottomBar();
  
      $('a[href="#"]').click(function (event) {
        event.preventDefault();
        const noUrlMessage = document.getElementById('noUrlMessage');
        noUrlMessage.style.display = 'block';
        setTimeout(function () {
          noUrlMessage.style.display = 'none';
        }, 2000);
      });
  
      const loadingMessage = document.getElementById('loadingMessage');
      window.addEventListener('beforeunload', function () {
        loadingMessage.style.display = 'block';
      });
      window.onload = function () {
        loadingMessage.style.display = 'none';
      };
      window.addEventListener('popstate', function () {
        loadingMessage.style.display = 'none';
      });
      window.addEventListener('pageshow', function (event) {
        if (event.persisted) {
          loadingMessage.style.display = 'none';
        }
      });

      // Client-side searching of dashboard items
      const searchInput = document.getElementById('searchInput');
      const dashboardItems = document.getElementById('dashboardItems');
      
      searchInput.addEventListener('keyup', function() {
        const query = this.value.toLowerCase().trim();
        const navItems = dashboardItems.querySelectorAll('.nav-item, .nav-header');
        
        navItems.forEach(item => {
          const text = item.textContent.toLowerCase();
          if (text.includes(query)) {
            item.style.display = '';
          } else {
            // Hide both nav-items and headers that don't match
            item.style.display = 'none';
          }
        });
      });
    });
  </script>
</body>
</html>
